# 跨链协议 ILP

### 操作模型

本协议采用“转账锁定机制”，来确保发送者的资金会被发送到接收者，否则会返回发送者账户。下面的例子来说明这个模型：

`(1,21)                                        (11)`

`应用                   连接器                  应用`

`\                     |                     /`

`(2,20)              (6,16)             (10,12)`

`跨链模块            跨链模块            跨链模块`

`\            /       \            /`

`(3,19)    (5,17)     (7,15)    (9,13)`

`本地账本接口-1        本地账本接口-2`

`|                  |`

`(4,18)            (8,14)`

`本地账本 1         本地账本 2`



1. 发送方应用程序先使用本地的高级别协议确定地址、金额、密码学信息，并确定一个目标账本的超时条件。然后用这些参数拼装成一个“支付消息”发送给跨链模块。

1. 跨链模块准备好跨链协议报文，选定用于向本地账本发送交易的账号，并发往本地账本接口。

1. 本地账本接口创建一个本地账本的转账交易，包含加密信息参数，然后在本地账本中验证这次转账请求。

1. 锁定资金，先不转账，通知connector

1. 连接器收到通知，传给跨链模块

1. 连接器的跨链模块解析出跨链请求报文，判断出应该往哪进行支付。跨链模块调用目标账本的本地接口，发送第二个交易报文，包含sender交易中的相同内容

1. 本地接口收到交易，然后认证授权本次交易发往本地账本。

1. 账本锁定连接器的资金——并不会直接转移给收款人——并且通知目标主机

1. 目标主机本地账本接口收到通知，传给跨链模块

1. 跨链模块解析跨链支付信息包，并确定支付到哪个应用。然后它将数据传递给应用程序。

1. 收款方应用收到提示，识别资金，并锁定履行情况为暂存状态。检查sender声明的入款执行情况。如果检查通过，收款方应用就产生一个履行结果并传递给跨链模块。

1. 收款人的跨链账本模块把操作履行情况传给本地账本接口。

1. 本地账本接口向账本提交支付结果情况

1. 收款方账本验证履行结果中对应的被锁定交易情况。如果履行情况检查通过，并且转账没有过期，则账本执行转账，并通知收款方连接器。

1. 连接器本地账本接口收到履行结果通知，并传给跨链模块

1. 连接器的跨链模块接收到履行结果，传递给本地账本，作为付款账本的响应。

1. 这个账本接口提交履行给付款账本。

1. 原账本验证支付结果，检查付款锁定条件。如果履行结果有效，转账没有过期，则账本执行转账，并通知给付款方。

1. 付款方本地账本接口收到支付结果通知，并传给跨链模块。

1. 发送者跨链模块接收到支付结果提醒，并传递给应用程序。

1. 付款方应用收到支付结果消息。

\#\#\# 功能描述

跨链协议的目的，是要帮助主机提供一个支付过程中的路由能力，使得交易可以在一组账本间彼此联通。主要方法就是在等到收款方确认之后，再通过一个跨链模块把交易发送到另一个跨链模块。在跨链系统中，跨链模块是作为应用主机和连接器中的一部分存在的。为支付信息进行跨链交易路由时，每个账本内的地址是由跨链寻址功能来进行解释的。这样，跨链协议的一个中心组件就是跨链寻址功能。

在大金额交易场景中，连接器和中间账本选择的路由的算法可能是不够可信的。有潜在账本提供的锁定机制“可能”会保护发送者和接受者信息。在这种情况下，跨链交易报文需要含有加密信息和有效时限。

